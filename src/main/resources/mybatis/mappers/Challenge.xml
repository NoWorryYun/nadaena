<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Challenge">

	<resultMap id="resultChallengeVo" type="ChallengeVo">
		<result column="challengeNo" property="challengeNo" />
		<result column="interestNo" property="interestNo" />
		<result column="clgTitle" property="clgTitle" />
		<result column="img" property="img" />
		<result column="regDate" property="regDate" />
		<result column="recruitment" property="recruitment" />
		<result column="period" property="period" />
		<result column="certify" property="certify" />
		<result column="minigame" property="minigame" />
		<result column="upload" property="upload" />
		<result column="certifyDay" property="certifyDay" />
		<result column="content" property="content" />
		<result column="color" property="color" />
		<result column="tag1" property="tag1" />
		<result column="tag2" property="tag2" />
		<result column="tag3" property="tag3" />
		<result column="tag4" property="tag4" />
		<result column="tag5" property="tag5" />
		<result column="clgLevel" property="clgLevel" />
		<result column="clgGroup" property="clgGroup" />
	</resultMap>

	<!-- /////////////////////////////// 챌린지 개설 관련 xml /////////////////////////////// -->	
	<!-- 일반 챌린지만들기 -->
	<insert id="writeChallenge" parameterType="ChallengeVo">
		
		<selectKey keyProperty="challengeNo" resultType="int" order="BEFORE">
		    select seq_challengeNo.nextval from dual
		</selectKey>
		
		<![CDATA[
			insert into challenge
			values( #{challengeNo},
					#{interestNo}, 
					#{clgTitle}, 
					#{img},
					to_char(sysdate, 'yy-mm-dd'), 
					#{recruitment}, 
					#{period}, 
					#{certify},
					#{minigame}, 
					#{upload}, 
					#{certifyDay},
					#{content},
					#{color},
					#{tag1},
					#{tag2},
					#{tag3},
					#{tag4},
					#{tag5},
					#{clgLevel},
					1
				)
		]]>
	</insert>
	
	<!-- 챌린지 과제 만들기 -->
	 <insert id="makeSubject" parameterType="ChallengeVo">
      <![CDATA[   
         insert into certify
            values (
            seq_certifyNo.nextval,
            #{challengeNo}, 
            #{certifyTitle }, 
            #{subOn },
			#{subOff}
			)
       ]]>
   </insert>
   
	<!-- 챌린지 참여(방장) -->
	<insert id="joinChallengeHeader" parameterType="ChallengeVo">
		<![CDATA[
		insert into mychallenge 
		values(
		    seq_userClgNo.nextval,
		    #{challengeNo},
		    #{userNo},
		    sysdate,
		    #{payment},
		    1,
		    1,
		    0
		)
		]]>
	</insert>
	<!-- /////////////////////////////////////////////////////////////////////// -->
	
	
	
	<!-- ///////////////////////////챌린지 세부 페이지 관련/////////////////////////// -->
	<!-- 챌린지 intro -->
	<select id="intro"  parameterType="int" resultType="ChallengeVo">
		<![CDATA[
			select challengeNo,
			       c.interestNo interestNo,
			       i.interestName interestName,
			       clgTitle, 
			       img,
			       to_char(sysdate, 'yy-mm-dd'), 
			       recruitment, 
			       period, 
			       certify,
			       minigame, 
			       upload, 
			       certifyDay,
			       content,
			       tag1,
			       tag2,
			       tag3,
			       tag4,
			       tag5,
			       clgLevel,
			       clgGroup
			from challenge c, interest i
			where c.interestno = i.interestno(+)
			and c.challengeNo = #{challengeNo}
		]]>
	</select>

	<!-- 챌린지 참여(유저) -->
	<insert id="joinChallenge" parameterType="ChallengeVo">
		<![CDATA[
		insert into mychallenge 
		values(
		    seq_userClgNo.nextval,
		    #{challengeNo},
		    #{userNo},
		    sysdate,
		    #{payment},
		    2,
		    1,
		    0
		)
		]]>
	</insert>

	<!-- 북마크 확인 -->
	<select id="bookMark" parameterType="int" resultType="int">
		<![CDATA[
			select count(challengeNo)
			from bookmark
			where userNo = #{userNo}
		]]>
	</select>

	<!-- 북마크 설정 -->
	<insert id="chkBM" parameterType="ChallengeVo">
		<![CDATA[
			insert into bookmark
			values(seq_bookmarkNo.nextval, #{userNo}, #{challengeNo}, sysdate)
		]]>
	</insert>

	<!-- 북마크 해제 -->
		<delete id="unChkBM" parameterType="ChallengeVo">
			<![CDATA[
			delete from bookmark
			where userNo = #{userNo}
			and challengeNo = #{challengeNo}
			]]>
		</delete>
		
		
		
	<!-- certify -->
	<select id="certifyList" parameterType="int" resultType="ChallengeVo">
		<![CDATA[
			select  certifyNo,
					challengeNo,
					certifyTitle,
					subOn,
					subOff
			from certify
			where challengeNo = #{challengeNo}
		]]>
	</select>
	
	<!-- 카테고리 이름 가져오기 -->
	<select id="cateId" parameterType="int" resultType="String">
		<![CDATA[
			select interestName
			from interest
			where interestNo = #{interestNo}		
		]]>
	</select>

	<insert id="ChallengeCertify" parameterType="ChallengeVo">
		<![CDATA[
			insert into challenge
			values( seq_certifyNo.nextval,
					#{challengeNo},
					#{clgTitle}, 
					#{img},
					to_char(sysdate, 
					'yy-mm-dd'), 
					#{recruitment}, 
					#{period}, 
					#{certify},
					#{minigame}, 
					#{upload}, 
					#{certifyDay},
					#{content},
					#{tag1},
					#{tag2},
					#{tag3},
					#{tag4},
					#{tag5},
					#{clgLevel},
					#{clgGroup}
				)
		]]>
	</insert>


</mapper>
