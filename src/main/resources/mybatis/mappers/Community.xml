<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Community">

	<!-- 커뮤니티 리스트 불러오기 -->
	<select id="comuList" parameterType="BoardVo" resultType="BoardVo">
		<![CDATA[
			select  rn,
			        ort.userNo,
			        ort.nickName,
			        ort.boardNo,
			        ort.challengeNo,
			        ort.category,
			        ort.title,
			        ort.boardContent,
			        ort.hit,
			        ort.boardDate,
			        boardDate2
			from(select rownum rn,
			            ot.userNo,
			            ot.nickName,
			            ot.boardNo,
			            ot.challengeNo,
			            ot.category,
			            ot.title,
			            ot.boardContent,
			            ot.hit,
			            ot.boardDate boardDate,
			            boardDate2
			    from (select    u.userNo userNo,
			                    u.nickName,
			                    b.boardNo boardNo,
			                    c.challengeNo challengeNo,
			                    b.category category,
			                    b.title title,
			                    b.content boardContent,
			                    b.hit hit,
			                    b.boardDate boardDate,
			                    to_char(boardDate,'YYYY-MM-DD') boardDate2
			         from users u, challenge c, board b
			         where u.userNo = b.userNo
			         and c.challengeNo = b.challengeNo
			         and c.challengeNo = #{challengeNo}
		]]>	
				
				
				<if test="keyword != ''  and  keyword != null ">
					and c.clgTitle like '%'||#{keyword}||'%'
				</if>
				
				<if test="category gt 0 ">
					and b.category = #{category}
				</if>
		
		
		
		<![CDATA[
			         
			         
			         
			         
			     order by boardNo desc) ot
			    )ort
			where ort.rn >=1
			and ort.rn <=10
			
		]]>
	</select>




	<select id="comentList" resultType="BoardVo">
		<![CDATA[
			select  rn,
			        ort.userNo,
			        ort.nickName,
			        ort.boardNo,
			        ort.challengeNo,
			        ort.category,
			        ort.title,
			        ort.boardContent,
			        ort.hit,
			        ort.boardDate,
			        ort.boarPass,
			        ort.commentNo,
			        ort.commentDate,
			        ort.comments,
			        ort.boardDate2,
			        ort.commentDate2
			from (select rownum rn,
			             ot.userNo,
			             ot.nickName,
			             ot.boardNo,
			             ot.challengeNo,
			             ot.category,
			             ot.title,
			             ot.boardContent,
			             ot.hit,
			             ot.boardDate,
			             ot.boarPass,
			             ot.commentNo,
			             ot.commentDate,
			             ot.comments,
			             ot.boardDate2,
			             ot.commentDate2
			    from(select u.userNo userNo,
			                u.nickName nickName,
			                b.boardNo boardNo,
			                c.challengeNo challengeNo,
			                b.category category,
			                b.title title,
			                b.content boardContent,
			                b.hit hit,
			                b.boardDate boardDate,
			                b.boarPass boarPass,
			                cm.commentNo commentNo,
			                cm.commentDate commentDate,
			                cm.comments comments,
			                to_char(boardDate,'YYYY-MM-DD') boardDate2,
			                to_char(commentDate,'YYYY-MM-DD') commentDate2
			        from users u, challenge c, board b, comments cm
			        where u.userNo = b.userNo
			        and c.challengeNo = b.challengeNo
			        and cm.boardNo = b.boardNo
			        and c.challengeNo = #{challengeNo}
			        order by commentNo desc) ot
			    )ort
			where ort.rn >=1
			and ort.rn <=10
		
		]]>
	</select>


	<select id="comuInfo" parameterType="BoardVo" resultType="BoardVo">
		<![CDATA[
			select  u.userNo userNo,
                    u.nickName nickName,
                    b.boardNo boardNo,
                    b.title title,
                    b.content boardContent,
                    b.hit hit,
                    to_char(boardDate,'YYYY-MM-DD') boardDate,
                    b.boarPass boarPass
	        from users u, board b
	        where u.userNo = b.userNo
	        and b.challengeNo = #{challengeNo}
            and b.boardNo = #{boardNo}
        
		
		]]>
	</select>

	<select id="comment" parameterType="BoardVo" resultType="com.nadaena.vo.CommentVo">
		<![CDATA[
			select  commentNo,
			        to_char(commentDate,'YYYY-MM-DD') commentDate,
			        comments,
			        u.nickName,
			        u.userNo
			from users u, comments c
			where u.userNo = c.userNo
			and c.boardNo = #{boardNo}
			order by commentNo desc
       	
		]]>
	</select>



</mapper>